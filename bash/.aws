#!/bin/bash


bl() {  # latest build logs in CLI; required arg is AWS stage
    [ $# -eq 0 ] && echo "Error: No args passed" && return
    aws-azure-login -f --profile $AWS_PROFILE --mode=debug
    aws s3 cp "s3://$BUILD_ARTIFACTS_BUCKET/$1-back-end-build-logs/$(aws s3 ls "s3://$BUILD_ARTIFACTS_BUCKET/${1}-back-end-build-logs/" | sort -n | tail -1 | awk '{ print $4 }' )" - | zcat -
}

open_lambda() {  # pop open browser to particular Lambda; first arg Lambda name; second arg (optional) AWS region
    if [ $# -eq 0 ]; then
        # If no arguments are passed, use fzf to select a Lambda folder
        lambda_folder=$(find ~/projects/wcp-aws/lambdas -type d -not -path '*/node_modules*' -not -path '*/node_modules' | fzf)
        [ -z "$lambda_folder" ] && echo "Error: No Lambda folder selected" && return
        lambda_name=$(basename "$lambda_folder")
        AWS_REGION="us-east-1"
    elif [ $# -eq 1 ]; then
        lambda_name=$1
        AWS_REGION="us-east-1"
    elif [ $# -eq 2 ]; then
        lambda_name=$1
        AWS_REGION=$2
    else
        echo "Error: Invalid number of arguments"
        return
    fi
    URL="https://${AWS_REGION}.console.aws.amazon.com/lambda/home?region=${AWS_REGION}#/functions/$lambda_name?tab=monitoring"
    echo "Opening: $URL"
    cmd.exe /c start "$URL" 2>/dev/null
}
